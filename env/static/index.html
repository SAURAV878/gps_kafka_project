<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>GPS Data Uploader</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <h1>GPS Data Form</h1>
        <label for="device_id">Device ID:</label>
        <input id="device_id" type="text" placeholder="eg tracker 01">

        <label for="latitude">Latitude:</label>
        <input id="latitude" type="number" step="any" placeholder="eg 27.3256">

        <label for="longitude">Longitude</label>
        <input id="longitude" type="number" step="any" placeholder="eg 85.2655">

        <button id="send">Preview Data</button>
        <pre id="output"></pre>

        <script>

            let intervalID; //variable that will hold the timer id

            const button = document.getElementById('send');
            button.onclick = () => {
               
                const id = document.getElementById('device_id').value;
                let lat = parseFloat(document.getElementById('latitude').value);
                let lon = parseFloat(document.getElementById('longitude').value);

                if (intervalID) clearInterval(intervalID);

                const step = 0.0003;  // controls how far the rider moves eacch upadte

                const delay = 2000; // tells setinterval how often to run that blaovk

              intervalID = setInterval(() => {
                    lat += (Math.random() - 0.5) * step;
                    lon += (Math.random() - 0.5) * step;

                    const data = {
                        device_id : id,
                        latitude: parseFloat(lat.toFixed(6)),
                        longitude: parseFloat(lon.toFixed(6)),
                        timestamp: Date.now()
                    };

                    const output = document.getElementById('output');
                    output.style.display = 'block';
                    output.textContent = JSON.stringify(data, null, 2);

                //send the same data to the pyhton server
                    fetch ("http://127.0.0.1:8080/api/gps", {
                        method : "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify(data)
                    })
                    .then(res => res.json())
                    .then(reply => console.log("Server repiled:", reply))
                    .catch(err => console.error("Error:", err));

                
                
            };
        </script>

    </body>
</html>